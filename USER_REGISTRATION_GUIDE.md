# ユーザー登録手順ガイド

## 概要
このアプリケーションでは、権限管理のセキュリティを確保するため、ユーザー登録はSupabaseの管理画面から直接行います。

## 具体的なアクション手順

### 1. Supabase管理画面でのユーザー追加

#### Step 1: Authentication → Users でユーザーを追加
1. Supabaseプロジェクトの管理画面にログイン
2. 左サイドバーから「Authentication」を選択
3. 「Users」タブをクリック
4. 「Add user」ボタンをクリック
5. 以下の情報を入力：
   - **Email**: ユーザーのメールアドレス
   - **Password**: 初期パスワード（ユーザーが後で変更可能）
   - **Email Confirm**: チェックを入れる（メール確認をスキップ）

#### Step 2: user_roles テーブルにレコードを追加
1. Supabaseの「Table Editor」を選択
2. `user_roles` テーブルを開く
3. 「Insert」→「Insert row」をクリック
4. 以下の情報を入力：
   - **email**: Step 1で追加したユーザーのメールアドレス
   - **role**: ユーザーの権限（'owner', 'cast', 'driver'のいずれか）
   - **display_name**: アプリ内で表示される名前
   - **created_at**: 自動設定（現在時刻）

### 2. 権限の種類と説明

| 権限 | 英語名 | 説明 | アクセス可能な機能 |
|------|--------|------|-------------------|
| オーナー | owner | 最高権限 | 全機能（管理者画面、ユーザー管理、売上管理等） |
| キャスト | cast | 一般スタッフ | 出退勤、取引記録 |
| ドライバー | driver | 配送担当 | 出退勤、取引記録 |

### 3. 確認手順

#### Step 3: ユーザーが正常に登録されているか確認
1. アプリケーションにログインを試行
2. ホーム画面でユーザー名と権限が正しく表示されるか確認
3. 権限に応じた機能にアクセスできるか確認

### 4. トラブルシューティング

#### ログインできない場合
- Authenticationのユーザー一覧でメール確認済みになっているか確認
- user_rolesテーブルにレコードが正しく追加されているか確認
- メールアドレスの入力ミスがないか確認

#### 権限が正しく反映されない場合
- user_rolesテーブルのroleカラムの値を確認
- アプリケーションを再読み込みして認証情報を更新

### 5. セキュリティ注意事項

- **owner権限**は慎重に付与する（管理者機能への完全アクセス）
- 初期パスワードは安全なものを設定し、ユーザーに変更を促す
- 不要になったユーザーは速やかに削除する

### 6. 一括登録用SQLクエリ（参考）

複数ユーザーを一度に登録する場合のSQLクエリ例：

```sql
-- user_rolesテーブルに複数ユーザーを一括追加
INSERT INTO user_roles (email, role, display_name) VALUES
('user1@example.com', 'cast', 'ユーザー1'),
('user2@example.com', 'driver', 'ユーザー2'),
('user3@example.com', 'cast', 'ユーザー3');
```

**注意**: Authenticationでのユーザー作成は管理画面から個別に行う必要があります。